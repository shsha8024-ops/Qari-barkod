<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>âš¡ Ù…ÙÙƒÙƒ PDF ÙÙˆØ±ÙŠ</title>
<style>
  body {
    background:#000;
    color:#0ff;
    font-family:'Tajawal',sans-serif;
    text-align:center;
    margin:0;
    padding:40px;
  }
  textarea {
    width:90%;
    height:180px;
    background:#111;
    color:#0ff;
    border:1px solid #0ff;
    border-radius:8px;
    padding:10px;
    direction:ltr;
  }
  button {
    margin:10px;
    padding:10px 25px;
    font-size:16px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    color:#fff;
    background:#06f;
  }
  #pdfViewer {
    width:90%;
    height:500px;
    margin-top:20px;
    display:none;
    border-radius:10px;
    border:none;
  }
</style>
</head>
<body>
<h2>âš¡ Ù…ÙÙƒÙƒ PDF Ø§Ù„Ø£Ø³Ø±Ø¹</h2>
<textarea id="input" placeholder="Ø£Ù„ØµÙ‚ Ø§Ù„Ø±Ø¯ Ø§Ù„ÙƒØ§Ù…Ù„ Ù‡Ù†Ø§ (ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ pdf_base64)"></textarea><br>
<button id="decode">ğŸ”“ ÙÙƒ Ø§Ù„ØªØ±Ù…ÙŠØ²</button>
<button id="openBtn" style="display:none;background:#0f0;">ğŸ“‚ ÙØªØ­</button>
<button id="downloadBtn" style="display:none;background:#08f;">ğŸ’¾ ØªØ­Ù…ÙŠÙ„</button>
<iframe id="pdfViewer"></iframe>

<script>
const input=document.getElementById("input");
const decode=document.getElementById("decode");
const pdfViewer=document.getElementById("pdfViewer");
const openBtn=document.getElementById("openBtn");
const downloadBtn=document.getElementById("downloadBtn");
let pdfUrl=null,blob=null;

function extractJSON(text){
  const start=text.indexOf('{');
  const end=text.lastIndexOf('}');
  if(start===-1||end===-1)return null;
  try{return JSON.parse(text.slice(start,end+1));}catch{return null;}
}

decode.onclick=()=>{
  const raw=input.value.trim();
  if(!raw)return alert("âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø£ÙˆÙ„Ø§Ù‹");
  const json=extractJSON(raw);
  if(!json||!json.pdf_base64)return alert("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ pdf_base64");
  try{
    const base64=json.pdf_base64.replace(/[^A-Za-z0-9+/=]/g,"");
    const bytes=Uint8Array.from(atob(base64),c=>c.charCodeAt(0));
    blob=new Blob([bytes],{type:"application/pdf"});
    pdfUrl=URL.createObjectURL(blob);
    pdfViewer.src=pdfUrl;
    pdfViewer.style.display="block";
    openBtn.style.display="inline-block";
    downloadBtn.style.display="inline-block";
  }catch(e){alert("âš ï¸ Ø®Ø·Ø£ ÙÙŠ ÙÙƒ Ø§Ù„ØªØ±Ù…ÙŠØ²");}
};

openBtn.onclick=()=>{if(pdfUrl)window.open(pdfUrl,"_blank");};
downloadBtn.onclick=()=>{if(blob){const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="decoded.pdf";a.click();}};
</script>
</body>
</html>